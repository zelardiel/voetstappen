<head>
	<meta charset=utf-8 />
    <title>Find the nearest beach!</title>
    <meta name="viewport" width="device-width" />
	<!-- // <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&amp;sensor=true&amp;libraries=places"></script> -->
	 <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
</head>
<body>
	<article>
		<p>Finding your location: <span id="status">checking...</span></p>
	</article>
	<div id="map">
	</div>
	<script type="text/javascript">
	$(document).ready(function(){
		init();
		function init() {
			console.log('doing this');
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(success, error);
			} else {
				error('not supported');
			}	
		}
	

		function initMap(position) {
			console.log('doing this');
			var mapcanvas = document.createElement('div');
			mapcanvas.id = 'mapcanvas';
			mapcanvas.style.height = '100%';
			mapcanvas.style.width = '100%';

			document.querySelector('#map').appendChild(mapcanvas);

			appendMap(position);
			// Load map on canvas
		
			
		}

		function appendMap(position) {
			// create variable latlng with the coordenates from geolocator
			var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
			// options for the map
			var myOptions = {
				zoom: 12,
				center: latlng,
				mapTypeControl: false,
				navigationControl: false,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			};

			var map = new google.maps.Map(document.getElementById("mapcanvas"), myOptions);

			createMarkers(position, map, latlng);
		}

		function createMarkers(position, map, latlng) {
			// Drop marker with coordinates gotton from GeoLocation
			var marker = new google.maps.Marker({
				position: latlng, 
				map: map, 
				title:"You are here! (at least within a "+position.coords.accuracy+" meter radius)"
			});

			// make a variable that contains an image
			var image = 'img/voetstap2klein.png';

			// vul een variabele met de een voetstap voor de nog niet gevonden voetstappen
			var voetstapNietGevonden = 'img/voetstap1klein.png';

			// Drop marker with coordinates (from database) that has as icon the variable filled with the image
			var voetstap1position = new google.maps.LatLng(52.3700, 4.8900);

			// Drop Voetstap1 marker with image from image variable
			var voetstap1 = new google.maps.Marker({
				position: voetstap1position, 
				map: map, 
				title:"voetstap1",
				icon: image,
			});

			// // Fill variable with text to display on markerClick
			// var text = '<div>De text als je op een marker heb geklikt</a></div>';

			// // Fill infoWindow with text from variable
			// var infowindow = new google.maps.InfoWindow({
			//     content: text
			// });

			// // Add eventlistener on marker for onclick and let it open the filled infoWindow
			// google.maps.event.addListener(voetstap1, 'click', function() {
			// 	infowindow.open(map,voetstap1);
			// });
		}

		function createCircle() {
			var circle;
			var circleRadius = 20;

			// Place a circle that will cause the push
			circle = new google.maps.Circle({
				map: map,
				radius: circleRadius,
				strokeColor: "#FF0000",
			    strokeOpacity: 0.8,
			    strokeWeight: 2,
			    fillColor: "#FF0000",
			    fillOpacity: 0.35
			});

			circle.setCenter(voetstap1position);

			// Get the bounds of the circle
			var bounds = circle.getBounds();

			// Check if our extracted latlng is in this bounds
			if (bounds.contains(latlng)){
				//Redirect
				alert('HIT!');
			}
		}
			
		function success(position) {
			console.log(position);

			var s = document.querySelector('#status');

			s.innerHTML = "found you!";
			s.className = 'success';

			if (s.className == 'success') {
			// not sure why we're hitting this twice in FF, I think it's to do with a cached result coming back
				  initMap(position);
			}
		}

		// Error handling
		function error(msg) {
			var s = document.querySelector('#status');
			s.innerHTML = typeof msg == 'string' ? msg : "failed";
			s.className = 'fail';
		}
});
	</script>
</body>
</html>